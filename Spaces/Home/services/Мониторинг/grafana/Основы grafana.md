## Войдите в Графану

Grafana — это платформа с открытым исходным кодом для мониторинга и наблюдения, которая позволяет вам визуализировать и исследовать состояние ваших систем.

1. Откройте новую вкладку.
    
2. Перейдите к [localhost:3000](http://localhost:3000) .
    
3. В **адрес электронной почты или имя пользователя** введите **admin** .
    
4. В **пароле** введите **admin** .
    
5. Нажмите **«Войти»** .
    
    При первом входе в систему вас попросят сменить пароль:
    
6. В **поле Новый пароль** введите новый пароль.
    
7. В **поле Подтвердите новый пароль** введите тот же пароль.
    
8. Нажмите **Сохранить** .
    

Первое, что вы видите, — это домашняя панель управления, которая поможет вам начать работу.

В левом верхнем углу вы можете увидеть значок меню. При нажатии на нее откроется _боковая панель_ — главное меню для навигации по Grafana.

## Добавьте источник данных метрик

Пример приложения предоставляет метрики, которые хранятся в [Prometheus](https://prometheus.io/) , популярной базе данных временных рядов (TSDB).

Чтобы иметь возможность визуализировать метрики Prometheus, сначала необходимо добавить их в качестве источника данных в Grafana.

1. На боковой панели нажмите **«Подключения»** , а затем **«Источники данных»** .
2. Нажмите **Добавить источник данных** .
3. В списке источников данных нажмите **«Прометей»** .
4. В поле URL-адрес введите **http://prometheus:9090** .
5. Прокрутите страницу вниз и нажмите **«Сохранить и протестировать»** .

Вы должны увидеть сообщение «Успешно выполнен запрос к API Prometheus». Это означает, что Prometheus теперь доступен в качестве источника данных в Grafana.
# Переменные

Переменная — это заполнитель для значения. Вы можете использовать переменные в запросах метрик и в заголовках панелей. Поэтому, когда вы меняете значение, используя раскрывающийся список в верхней части панели управления, запросы метрик вашей панели изменятся, чтобы отразить новое значение.

Чтобы создать новую переменную, зайдите в настройки панели инструментов Grafana, перейдите к параметру «Переменная» в боковом меню и нажмите кнопку «Добавить переменную».  
  
В этом случае мы используем тип `Query`, где наша переменная будет определена как результат запроса SQL.  
  
![](https://habrastorage.org/r/w1560/webt/s2/zy/y_/s2zyy_cwjoy3wv_wfu1obpvrfca.jpeg)  
_Как создать переменную типа Query_  
  
В разделе General мы назовем нашу переменную `route`. Затем мы присвоим ей метку MTA Bus Route.  
  
![](https://habrastorage.org/r/w1560/webt/r3/uv/of/r3uvofo5ieluzg4-jzyzj-aj9ho.jpeg)  
_Имя, метка и тип нашей переменной `route`_  
  
Метки в Grafana — это удобочитаемые дескрипторы, которые отображаются рядом с выпадающим меню в дашборде:  
  
![](https://habrastorage.org/r/w1560/webt/nl/gm/x5/nlgmx59nhpoaso-zhbvyj-nc1eu.jpeg)  
  
Метки переменных отображаются в дашборде, а имя переменной используется для ссылки на переменную в запросах, используемых в дашбордах.  
  
Затем напишем запрос, который определяет значение переменной, в разделе `Query options`.
  
![](https://habrastorage.org/r/w1560/webt/gm/to/xl/gmtoxld8phppoe0sm340zgiowsu.jpeg)  
_Настройки для создания переменной route_  
  
Нам нужно выбрать источник данных для нашей переменной — им будет база данных, в которой будет выполняться запрос. В этом случае мы используем MTA Bus DB, базу данных PostgreSQL, в которой хранятся наши [данные MTA Bus](https://github.com/timescale/examples/tree/master/mta).  
  
Теперь мы определим SQL-запрос, результаты которого будут определять нашу переменную `route`:  
  

```
SELECT * from (values ('M'),('B'),('Q'),('S')) v;
```

  
Этот запрос возвращает буквы M, B, Q, S — которые являются типами маршрутов на основе их `route_id` (для понимания см. запрос SQL в разделе предварительных требований).